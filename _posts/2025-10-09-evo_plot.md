---
title: evo对齐后轨迹输出及画图
date: 2025-10-09 16:30:00 +0800
categories: [SLAM]
tags: [SLAM, 工具]
toc: true 
comments: true
math: true
---

# evo使用

常规的evo_traj、evo_ape使用不再赘述。

对于两条未经对齐的轨迹，可以用-a参数对齐，并且输出对齐后的两条轨迹。

```shell
evo_traj tum --ref .\GroundTruth.txt .\Estimated.txt -va --save_as_tum
```

# 轨迹绘制

```python
import numpy as np
import matplotlib.pyplot as plt

# 设置论文风格
plt.rcParams.update({
    'font.size': 11,
    'font.family': 'serif',
    'font.serif': ['Times New Roman'],
    'figure.dpi': 300,
    'savefig.dpi': 300
})

# 数据文件和标题
datasets = ['kitti_01', 'kitti_04', 'kitti_07', 'kitti_09']
titles = ['(a) kitti_01', '(b) kitti_04', '(c) kitti_07', '(d) kitti_09']

# 创建图形，4个相等的正方形子图
# 调整figsize确保子图是正方形 - 每个子图4x4英寸
fig, axes = plt.subplots(1, 4, figsize=(16, 4))

for i, (dataset, title) in enumerate(zip(datasets, titles)):
    gt_file = f'GroundTruth_{dataset}.tum'
    est_file = f'Estimated_{dataset}.tum'
    
    try:
        # 加载数据
        gt_data = np.loadtxt(gt_file)
        est_data = np.loadtxt(est_file)
        
        # 提取x, y坐标
        gt_x, gt_y = gt_data[:, 1], gt_data[:, 3]
        est_x, est_y = est_data[:, 1], est_data[:, 3]
        
        # 绘制轨迹
        axes[i].plot(gt_x, gt_y, 'b--', linewidth=1.0, label='Ground Truth')
        axes[i].plot(est_x, est_y, 'r-', linewidth=1.0, label='Estimated')
        
        # 设置标题和标签
        axes[i].set_title(title, fontsize=11)
        axes[i].set_xlabel('X [m]')
        axes[i].set_ylabel('Z [m]')
        
        # 网格和强制正方形设置
        axes[i].grid(True, alpha=0.3, linewidth=0.5)
        axes[i].set_aspect('equal', adjustable='box')
        
        # 强制设置轴的范围使其为正方形
        xlim = axes[i].get_xlim()
        ylim = axes[i].get_ylim()
        
        # 计算最大范围
        x_range = xlim[1] - xlim[0]
        y_range = ylim[1] - ylim[0]
        max_range = max(x_range, y_range)
        
        # 设置相等的轴范围
        x_center = (xlim[0] + xlim[1]) / 2
        y_center = (ylim[0] + ylim[1]) / 2
        
        axes[i].set_xlim(x_center - max_range/2, x_center + max_range/2)
        axes[i].set_ylim(y_center - max_range/2, y_center + max_range/2)
        
        # 每个子图都添加图例
        axes[i].legend(fontsize=9, loc='upper right', frameon=False, 
                        fancybox=True, shadow=True, framealpha=0.9)
        # if i != 3:
        #     axes[i].legend(fontsize=9, loc='upper right', frameon=False, 
        #                 fancybox=True, shadow=True, framealpha=0.9)
        # else:
        #     axes[i].legend(fontsize=9, loc='upper left', frameon=False, 
        #                 fancybox=True, shadow=True, framealpha=0.9)
        
    except FileNotFoundError:
        axes[i].text(0.5, 0.5, 'Data not\navailable', 
                    ha='center', va='center', transform=axes[i].transAxes)
        axes[i].set_title(title)
        axes[i].set_xlabel('X [m]')
        axes[i].set_ylabel('Z [m]')
        axes[i].set_aspect('equal', adjustable='box')

# 调整子图间距，确保正方形不被压缩
plt.subplots_adjust(left=0.05, right=0.95, top=0.9, bottom=0.15, wspace=0.3)

plt.savefig('trajectory_comparison.png', dpi=300, bbox_inches='tight')
# plt.savefig('trajectory_comparison.pdf', bbox_inches='tight')
# plt.show()
```




